<!--This Document is generated by GameMaker, if you edit it by hand then you do so at your own risk!-->
<object>
  <spriteName>spr_Player</spriteName>
  <solid>0</solid>
  <visible>-1</visible>
  <depth>0</depth>
  <persistent>0</persistent>
  <parentName>&lt;undefined&gt;</parentName>
  <maskName>&lt;undefined&gt;</maskName>
  <events>
    <event eventtype="0" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///create global settings
death_time = 1;
default_room_speed = 60;

image_speed = 0;
</string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///create movement variables
respawning = false;

state = States.Normal;

grav = 0.75*(30/room_speed);
maxgrav = 20*(30/room_speed);
maxspeed = 20*(30/room_speed);

jumping_deadzone = 0.25;
movement_deadzone = 0.5



//ground settings
ground_maxspeed = maxspeed*0.65;
acceleration = 1.25*(30/room_speed);

moving_friction = 0;
stopping_friction = acceleration;
turning_friction = 2*acceleration;



//air settings
air_acceleration = 1*(30/room_speed);
air_moving_friction = 0.4*air_acceleration;
air_turning_friction = 1*air_acceleration;


hsp = 0;
vsp = 0;

jumpspeed = 20*(30/room_speed);
movespeed = 0;

player_number = 0;
</string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///create sword variables
attacking = false;
throwing = false;
has_sword = true;

my_sword = instance_create(x,y, obj_Sword);
with(my_sword)
{
    player = other.id;
    image_angle -= swipe_amount/2;
    offset = abs(other.sprite_width/2);
}
</string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///create blocking

max_block = 100;
blocking_shrink_time = 2.5; //seconds for block to deplete completely
blocking_grow_time = 5; //seconds for block to restore completely

blocking_shrink_step = max_block / (blocking_shrink_time * room_speed);
blocking_grow_step = max_block / (blocking_grow_time * room_speed);

block_level = max_block;
</string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///create input delay variables
jump_input_time = 0;
jump_input_delay = 0.2*room_speed; //frame delay

hit = noone;
block_window = 0.2*room_speed; //frames for incorrect timing window for blocking

</string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///blood settings
spurt_direction = 0;
scatter = 10;
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="2" enumb="3">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///throw shit!

scr_set_timescale(1, 0);

var attack_dir = 90 - image_xscale*90;

has_sword = false;

throwing = false;
/*
var attack_dir = abs(aim_direction);
if(abs(horizontal_amount) + abs(vertical_amount) &lt; deadzone)
{
    attack_dir = 0;
    if(image_xscale &lt; 0)
    {
        attack_dir += 180;
    }
}
*/
var thrown = instance_create(x,y,obj_ThrownSword);
with(thrown)
{
    player = other.id;
    attack_direction = attack_dir;
    
    image_angle = attack_direction;
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="2" enumb="2">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///validate hit
if(hit != noone)
{
    if(!respawning)
    {
        respawning = true;
        alarm[0] = death_time * room_speed;
        var othernum = hit.player.player_number;
        with(obj_Score)
        {
            scores[othernum]++;
        }
        spurt_direction = (point_direction(x,y, hit.player.x,hit.player.y)*3
                        + point_direction(hit.player.x,hit.player.y, x,y))/4;
        
        if(state == States.Normal)
            spurt_direction = spurt_direction%180;
        scr_spawn_blood(random_range(20,30), random(360), 180);
        
        //turn on slow mo
        scr_set_timescale(0.5, death_time*0.5);
    }
    hit = noone;
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="2" enumb="1">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///turn off attacking
attacking = false;
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="2" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///reset
respawning = false;
has_sword = true;
attacking = false;
hsp = 0;
vsp = 0;

var spawn = scr_furthest_spawn(self);
x = spawn.x;
y = spawn.y;

//turn off slow_mo
scr_set_timescale(1,0);
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="3" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>other</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///movement
if(!respawning)
{
    switch(state)
    {
        case States.Normal: scr_player_normal(); break;
        case States.InAir: scr_player_inair(); break;
        case States.WallRiding: scr_player_wallriding(); break;
    }
    
    //change image scale based on direction
    var previous_xscale = image_xscale
    image_xscale = sign(x - xprevious);
    if(image_xscale == 0) image_xscale = previous_xscale;
}
</string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///swing sword
var deadzone = 0.1;

if(!respawning &amp;&amp; !attacking &amp;&amp; has_sword)
{
    if(key_attack_normal)
    {
        var attack_dir = abs(aim_direction);
        if(abs(horizontal_amount) + abs(vertical_amount) &lt; deadzone)
        {
            attack_dir = 0;
            if(image_xscale &lt; 0)
            {
                attack_dir += 180;
            }
        }
        
        with(my_sword)
        {
            attack_direction = attack_dir;
            start_direction = image_angle;
            if(start_direction &lt; 0) start_direction += 360;
            start_direction = start_direction%360;
            
            var delta_direction = -1;
            if(!scr_clockwise_angle(start_direction, attack_direction))
            {
                delta_direction = 1;
            }
            direction_step = scr_angle_diff(start_direction, attack_direction);
            direction_step += swipe_amount;
            direction_step = direction_step/(attack_speed*room_speed);
            direction_step *= delta_direction;
            
            alarm[0] = attack_speed*room_speed;
            
            image_xscale = (min_size + size_gap/2) + (size_gap/2)*(-sin(degtorad(image_angle)));
            
            active = true;
        }
        attacking = true;
        alarm[1] = my_sword.attack_delay * room_speed;
    }
}
</string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///throw sword
if(key_shoot_press &amp;&amp; has_sword &amp;&amp; !throwing)
{
    alarm[3] = room_speed;
    //event_perform(ev_alarm, 3);
    
    throwing = true;
}
</string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///deplete blocking
if(key_block)
{
    block_level = max(0, block_level - blocking_shrink_step*global.timescale);
}
else
{
    block_level = min(block_level + blocking_grow_step*global.timescale, max_block);
}
</string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///check blocking for hitwindow

if(hit != noone)
{
    var blocked = scr_block_check(hit.damage);
    if(blocked)
    {
        hit = noone;
    }
}
</string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///check if KLANG happened
if(hit != noone)
{
    if(hit.player.hit != noone)
    {
        if(hit.player.hit.player == id)
        {
            //slow mo
            global.timescale = 0.25;
            scr_set_timescale(1,0.25);
            
            
            /*
            //set the knockback
            var other_player_x = hit.player.x;
            var other_player_y = hit.player.y;
            
            var my_push_dir = point_direction(other_player_x,other_player_y, x,y);
            var other_push_dir = point_direction(x,y, other_player_x,other_player_y);
            
            hsp = lengthdir_x(maxspeed, my_push_dir);
            vsp = lengthdir_y(maxspeed, (my_push_dir*3 + other_push_dir)/4);
            with(hit.player)
            {
                hsp = lengthdir_x(maxspeed, other_push_dir);
                vsp = lengthdir_y(maxspeed, (other_push_dir*3 + my_push_dir)/4);
            }
            */
            
            //destroy both swords so that we don't double down on this
            with(hit.player.hit)
            {
                active = false;
            }
            hit.player.hit = noone;
            with(hit)
            {
                active = false;
            }
            hit = noone;
        }
    }
}
</string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///spawn blood
if(respawning)
    scr_spawn_blood(1, spurt_direction, scatter);
</string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///check for slow mo for throwing

if(throwing)
{
    var slowdown = false;
    scr_set_timescale(1, 0);
    //check for anyone in the way
    var endx = x + room_width*image_xscale;
    var endy = y;
    with(obj_Player)
    {
        if(id != other.id)
        {
            var dst = sqrt(scr_distance_to_line_segment_squared(
                other.x, other.y,
                endx, endy,
                x,y
            ));
            if(dst &lt; abs(sprite_width*2))
            {
                slowdown = true;
            }
        }
    }
    
    if(slowdown)
    {
        scr_set_timescale(0.25, 0.25);
    }
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="4" ename="obj_Sword">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///check for hit

if(other.active &amp;&amp; other.player != id &amp;&amp; hit == noone)
{
    hit = other.id;
    alarm[2] = block_window;
    
    var angle = point_direction(x,y, hit.player.x,hit.player.y);
    with(hit)
    {
        draw_sprite_ext(sprite_index, image_index, x,y, image_xscale, image_yscale, angle, c_white, 1);
        scr_sleep(1000);
    }
}

</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="4" ename="obj_ThrownSword">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///check if valid and needed
if(!has_sword &amp;&amp; other.movespeed &lt;= 0)
{
    has_sword = true;
    with(other)
    {
        instance_destroy();
    }
}
else if(other.player != id &amp;&amp; other.movespeed &gt; 0 &amp;&amp; !respawning)
{
    respawning = true;
    alarm[0] = death_time * room_speed;
    var othernum = other.player.player_number;
    with(obj_Score)
    {
        scores[othernum]++;
    }
    spurt_direction = point_direction(x,y, other.x, other.y);
    scr_spawn_blood(random_range(30,60), 0, 180);
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="7" enumb="2">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///create states
enum States
{
    Normal,
    InAir,
    WallRiding
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="8" enumb="0">
      <action>
        <libid>1</libid>
        <id>500</id>
        <kind>0</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>0</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring>draw_self();</codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///show aiming
var len = 20;
draw_line_width(x,y,x + horizontal_amount*len, y + vertical_amount*len, 3);
</string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///draw player number
//draw_text(x,y,string(player_number));
</string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///draw block
if(key_block &amp;&amp; !attacking)
{
    var block_radius = sprite_width;
    var block_size = (block_level/max_block);
    //draw_circle(x,y, block_radius*(block_level/max_block), false);
    draw_sprite_ext(spr_Block, 0, x,y, block_size,block_size, 0, c_white, 1);
}
</string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///draw reloading indication
if(attacking)
{
    var timeleft = alarm[1];
    var sprite_num = sprite_get_number(spr_NoAttackIndicator);
    var frame = sprite_num - min(timeleft, sprite_num);
    draw_sprite(spr_NoAttackIndicator, frame, x,y - sprite_height/2);
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
  </events>
  <PhysicsObject>0</PhysicsObject>
  <PhysicsObjectSensor>0</PhysicsObjectSensor>
  <PhysicsObjectShape>0</PhysicsObjectShape>
  <PhysicsObjectDensity>0.5</PhysicsObjectDensity>
  <PhysicsObjectRestitution>0.100000001490116</PhysicsObjectRestitution>
  <PhysicsObjectGroup>0</PhysicsObjectGroup>
  <PhysicsObjectLinearDamping>0.100000001490116</PhysicsObjectLinearDamping>
  <PhysicsObjectAngularDamping>0.100000001490116</PhysicsObjectAngularDamping>
  <PhysicsObjectFriction>0.200000002980232</PhysicsObjectFriction>
  <PhysicsObjectAwake>-1</PhysicsObjectAwake>
  <PhysicsObjectKinematic>0</PhysicsObjectKinematic>
  <PhysicsShapePoints/>
</object>
